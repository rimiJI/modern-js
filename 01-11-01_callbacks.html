<!-- 콜백
공부⭕: 콜백 기본개념, 비동기 동작과 콜백 (동기VS비동기)
진도❌: 콜백속 콜백, 에러 핸들링,멸망의 피라미드 -->
<head>
  <title>callback</title>
  <style>
    pre {
      /* 2. '프리텐다드'를 가장 먼저 사용하도록 설정합니다. */
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size: 16px; /* 기본 폰트 크기를 살짝 키워 가독성을 높입니다. */
      line-height: 1.6; /* 줄 간격을 넓혀서 덜 답답하게 만듭니다. */
      background-color: #f7f7f7; /* 아주 연한 회색 배경을 추가해 영역을 구분합니다. */
      padding: 1em; /* 안쪽 여백을 줍니다. */
      border-radius: 8px; /* 모서리를 둥글게 만듭니다. */
    }
    .red {
      color: red;
      font-weight: bold;
    }
    .ml-1 {
      margin-left: 1em;
    }
  </style>
  <!-- 1. Prism.js의 CSS 파일을 불러옵니다 (기본 밝은 테마) -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
    rel="stylesheet"
  />
</head>

<body>
  <h3 style="color: rgb(172, 172, 172)">callback</h3>
  <div>
    <details>
      <summary>원하는 때에 동작 실행하는 특별한 함수는?</summary>
      <pre>콜백 callbacks함수</pre>
    </details>
  </div>

  <div>
    <details>
      <summary>
        어떤 작업을 기다리지 않고, "나중에 해줘"하고 맡겨놓는 방식을 뭐라고
        하는가?<br />지금 당장 안 끝나도 뒤에 있는 코드들이 먼저 실행될 수 있는
        것<br />기다리지 않고, 나중에 실행될 작업을 예약해둠 (예약표에 적어놓고
        바로 다른 일 하기)
      </summary>
      <pre>
         <code class="language-javascript">
    비동기 asynchronous
    
        console.log("A");
        setTimeout(() => {console.log("B -2초뒤실행");}, 2000);
        console.log("C");
          </code>
      </pre>
    </details>
  </div>
  <div>
    <details>
      <summary>하나 끝나야 다음 실행 (줄 서기)은?</summary>
      <pre>
         <code class="language-javascript">
        동기 synchronous
            
            console.log("A👁️👁️");
            console.log("B👁️👁️");
            console.log("C👁️👁️");
          </code>
      </pre>
    </details>
  </div>
  <div>
    <details>
      <summary>
        실무에서 맞닥뜨리는 비동기 동작은 아주 다양합니다. 스크립트나 모듈을
        로딩하는 것 또한 비동기 동작입니다
      </summary>
      <pre>아주 많이 쓰인다구!</pre>
    </details>
  </div>
  <div>
    <details>
      <summary>
        무언가를 비동기적으로 수행하는 함수를 함수내 동작이 모두 처리된 후
        <br />실행되어야하는 함수에 인수를 콜백으로 반드시 제공하는 프로그래밍
        방식은 무엇인가?
      </summary>
      <pre>콜백 기반(callback-based) 비동기 프로그래밍(동적)<code class="language-javascript">
    function loadScript(src, callback) {
      let script = document.createElement("script");
      script.src = src;

      script.onload = () => callback(script);

      document.head.append(script);
    }
    //함수 실행 ( 단, script는 js다 html이 아닌.)
    loadScript("01-11-01_test-callbacks.js", function () {
      //콜백함수는 스크립트 로드가 끝나면 실행됩니다.
      newFunction();
    });

    //함수 실행2 실제 존재하는 스크립트 이용 예시
    loadScript(
      "https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js",
      (script) => {
        alert(`${script.src}가 로드되었습니다.`); //실행1
        alert(_); // 스크립트에 정의된 함수        //실행2
      }
    );
      </code></pre>
    </details>
  </div>
  <div>
    <details>
      <summary>다음단계로 가기위한 최소 준비 지식 - 콜백 기본</summary>
      <pre><code class="language-javascript">
      function ask(q, y, n) {
        if (confirm(q)) y();
        else n();
        }

    ask(
    "동의??",
    () => console.log("보감!"),
    () => console.log("취소!")
    );
      </code></pre>
    </details>
    <details>
      <summary>다음단계로 가기위한 최소 준비 지식 - 비동기 콜백</summary>
      <pre><code class="language-javascript">
    console.log("1");
    setTimeout(() => console.log("2 - 3초뒤실행"), 3000);
    console.log("3")
      </code></pre>
    </details>
  </div>

  <script>
    //비동기 (예약해두고 다른 일하기)
    console.log("A");
    setTimeout(() => {
      console.log("B -2초뒤실행");
    }, 2000);
    console.log("C");

    //동기 (줄 서서 빤히 처다보면서 기다리기)
    console.log("A👁️👁️");
    console.log("B👁️👁️");
    console.log("C👁️👁️");

    //비동기 동작처리 (src에 있는 스크립트 읽어오는 함수 loadScript1 예시)
    function loadScript1(src) {
      //<script src="…">를 동적으로 만들고 이를 문서에 추가
      let script = document.createElement("script"); //태그생성
      script.src = src; //속성 src 동적 추가
      document.head.append(script); //문서에 추가
    }
    //위에서 만든거 실행
    //비동기적이다. 즉,
    loadScript1("01-11-01_test-callbacks.js"); //또는 loadScript1("./01-11-01_test-callbacks.html");
    //loadScript1 아래의 코드는
    //스크립트 로딩이 끝날 때까지 기다리지 않고
    //실행된다.

    //이거 안됨
    ////newFunction is not defined 뜸
    // newFunction();

    //Why??
    //브라우저가 스크립트 읽어로 시간 충분히 확보 못해서
    //loadScript의 두번째 인수로 callback함수 추가해보자.
    function loadScript(src, callback) {
      let script = document.createElement("script");
      script.src = src;

      script.onload = () => callback(script);

      document.head.append(script);
    }
    //함수 실행 ( 단, script는 js다 html이 아닌.)
    loadScript("01-11-01_test-callbacks.js", function () {
      //콜백함수는 스크립트 로드가 끝나면 실행됩니다.
      newFunction();
    });

    //함수 실행2 실제 존재하는 스크립트 이용 예시
    loadScript(
      "https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js",
      (script) => {
        console.log(`${script.src}가 로드되었습니다.`); //실행1
        console.log(_); // 스크립트에 정의된 함수        //실행2
      }
    );

    //다음단계로 가기위한 최소 준비 지식 - 콜백 기본
    function ask(q, y, n) {
      if (confirm(q)) y();
      else n();
    }

    ask(
      "동의??",
      () => console.log("보감!"),
      () => console.log("취소!")
    );

    //다음단계로 가기위한 최소 준비 지식 - 비동기 콜백
    console.log("1");
    setTimeout(() => console.log("2 - 3초뒤실행"), 3000);
    console.log("3");
  </script>

  <!-- 아래 둘 다 정상작동됨 -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/prism.min.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
</body>
